import os
from preprocesado_eeg import preprocesado_bandas
from cargar_datos_raw import diccionario_datos_procesados_por_tipo

# Obtener la ruta del script actual
dir_actual = os.path.dirname(os.path.abspath(__file__))

# Rutas relativas al proyecto
ruta_crop = os.path.abspath(os.path.join(dir_actual, "..", "EEG_crop"))
ruta_raw = os.path.abspath(os.path.join(dir_actual, "..", "EEG_raw"))
ruta_guardado = os.path.abspath(os.path.join(dir_actual, "..", "EEG_processed_bandas"))

# Verifica que las carpetas existan
print("📁 Buscando señales en:", ruta_crop)
print("📁 Usando datos brutos de:", ruta_raw)
print("📁 Guardando resultados en:", ruta_guardado)

# Cargar las rutas de señales tipo basal
archivos = diccionario_datos_procesados_por_tipo(ruta_crop, tipo="basal")
print(f"🔍 Total señales encontradas: {len(archivos)}")

# Aplicar el preprocesado a cada señal
for ruta_relativa, ruta_absoluta in archivos.items():
    print(f"⚙️ Procesando: {ruta_relativa}")
    try:
        preprocesado_bandas(
            ruta_fif=ruta_absoluta,
            ruta_base_crop=ruta_crop,
            ruta_base_guardado=ruta_guardado,
            ruta_base_raw=ruta_raw
        )
    except Exception as e:
        print(f"❌ Error en {ruta_relativa}: {e}")
